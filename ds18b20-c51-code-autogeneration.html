<!-- Author: Jks Liu(chinatianma@gmail.com) -->

<html>
  <head>
    <title>DS18B20 C51 Code AutoGeneration</title>
    <style>
      pre code {
          display: block; padding: 0.5em;
          color: #333;
          background: #f8f8ff
      }
      label {
          text-align:right;
      }
    </style>
  </head>
  
  <body>
    <script type='text/javascript' src='ds18b20-c51-code-autogeneration.js'></script>

    <p>
      <ul>
        <li><label>Colck frequence: </label>
        <input id='colck' size=10 onKeyUp='main()'> MHz. </li>
        
        <li><bable>Machine cycle(normal 12): </label>
         <input id='machine cycle' onKeyUp='main()' />. </li>
        

      </ul>
      <div id='djnz time ns echo'></div>
    </p>


    <h1>DS18B20 C51 Code AutoGeneration</h1>

    <h2>ds18b20.h</h2>
    <pre><code>
/* **********************************************************************
 * Author:  Jks Liu(chinatianma@gmail.com)
 * License: Public Domain
 * **********************************************************************/

/* **********************************************************************
 * Conventions used in ds18b20.c and ds18b20.h :
 *
 *      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
 *       NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
 *      "OPTIONAL" in this document are to be interpreted as described in
 *      [RFC 2119](www.ietf.org/rfc/rfc2119.txt).
 * **********************************************************************/

/* **********************************************************************
 * Manual:
 *
 * You MUST define macro `DS18B20_DQ' in hardware-config.h 
 * to indicate how your ds18b20 connects to 51 micro-controller.
 *
 * You MUST define these types in your software-config.h 
 * whih `#define' or `typedef':
 *    `uint16_t', `bool'
 * And you SHALL define `true' and `false' in the same file.
 *
 * Currently you can only use one ds18b20 on 1 bus.
 * **********************************************************************/
 
#ifndef DS18B20_H_
#define DS18B20_H_


#include "hardware-config.h"
#include "software-config.H"

#ifdef __cplusplus
extern "C"
{
#endif

/* **********************************************************************
 * Check if the ds18b20 device is present
 * 
 * Return value:
 *     true:  present
 *     false: not part
 * **********************************************************************/
bool ds18b20_search(void);

/* **********************************************************************
 * Read data from DS18B20 Temperature Register
 * **********************************************************************/
uint16_t ds18b20_get_raw(void);

#ifdef __cplusplus
}
#endif

#endif /* DS18B20_H_ */
    </code></pre>

    <h2>ds18b20.c</h2>

    <h2>ds18b20_c51.asm</h2>
    <pre><code>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Author: Jks Liu(chinatianma@gmail.com)
; License: Public Domain
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

NAME DS18B20_C51

EXTERN BIT(DS18B20_DQ)

; void ds18b20_delay(void)
?PR?ds18b20_delay?DS18B20_C51 SEGMENT CODE
PUBLIC ds18b20_delay
    RSEG ?PR?ds18b20_delay?DS18B20_C51
ds18b20_delay:
    DJNZ R7, $
    RET

; void ds18b20_delay_1ms(void);
?PR?ds18b20_delay_1ms?DS18B20_C51 SEGMENT CODE
PUBLIC ds18b20_delay_1ms
    RSEG ?PR?ds18b20_delay_1ms?DS18B20_C51
ds18b20_delay_1ms: <div id='delay_1ms'>REPLACE ME</div>    RET

; void ds18b20_write0_slot(void);
?PR?ds18b20_write0_slot?DS18B20_C51 SEGMENT CODE
PUBLIC ds18b20_write0_slot
    RSEG ?PR?ds18b20_write0_slot?DS18B20_C51
ds18b20_write0_slot:
    

; void ds18b20_write1_slot(void);

; bit ds18b20_read_slot(void);
    
    END
    </code></pre>

    <hr/>

    <h2>delay.h</h2>
    <pre><code>
/* **********************************************************************
 * Author:  Jks Liu(chinatianma@gmail.com)
 * License: Public Domain
 * **********************************************************************/

#ifndef DELAY_H_
#define DELAY_H_

#ifdef __cplusplus
extern "C"
{
#endif

void ds18b20_delay(unsigned char i);
void ds18b20_delay_ms(unsigned int i);

#ifdef __cplusplus
}
#endif

#define delay(x) ds18b20_delay(x)
#define delay_ms(x) ds18b20_delay_ms(x)

#endif /* DELAY_H_ */    
    </code></pre>
  </body>
</html>

<!-- Author: Jks Liu(chinatianma@gmail.com) -->

<html>
  <head>
    <title>DS18B20 C51 Code AutoGeneration</title>
    <style>
      pre code {
          display: block; padding: 0.5em;
          color: #333;
          background: #f8f8ff
      }
    </style>
  </head>
  
  <body>
    <script type='text/javascript' src='ds18b20-c51-code-autogeneration.js'></script>

    <p>
      Time of executing `DJNZ Rn, Address' instruction: 
      <input id='djnz time ns' size=10 onKeyUp='main()'>
      ns.
      <br/>
      <div id='djnz time ns echo'></div>
    </p>


    <h1>DS18B20 C51 Code AutoGeneration</h1>

    <h2>ds18b20.h</h2>
    <pre><code>
/* **********************************************************************
 * Author:  Jks Liu(chinatianma@gmail.com)
 * License: Public Domain
 * **********************************************************************/

/* **********************************************************************
 * Conventions used in ds18b20.c and ds18b20.h :
 *
 *      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
 *       NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
 *      "OPTIONAL" in this document are to be interpreted as described in
 *      [RFC 2119](www.ietf.org/rfc/rfc2119.txt).
 * **********************************************************************/

/* **********************************************************************
 * Manual:
 *
 * You MUST define macro `DS18B20_DQ' in hardware-config.h 
 * to indicate how your ds18b20 connects to 51 micro-controller.
 *
 * You MUST define these types in your software-config.h 
 * whih `#define' or `typedef':
 *    `uint16_t', `bool'
 * And you SHALL define `true' and `false' in the same file.
 *
 * Currently you can only use one ds18b20 on 1 bus.
 * **********************************************************************/
 
#ifndef DS18B20_H_
#define DS18B20_H_


#include "hardware-config.h"
#include "software-config.H"

#ifdef __cplusplus
extern "C"
{
#endif

/* **********************************************************************
 * Check if the ds18b20 device is present
 * 
 * Return value:
 *     true:  present
 *     false: not part
 * **********************************************************************/
bool ds18b20_search(void);

/* **********************************************************************
 * Read data from DS18B20 Temperature Register
 * **********************************************************************/
uint16_t ds18b20_get_raw(void);

#ifdef __cplusplus
}
#endif

#endif /* DS18B20_H_ */
    </code></pre>

    <h2>ds18b20.c</h2>

    <h2>ds18b20_delay.asm</h2>
    <pre><code>
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
; Author: Jks Liu(chinatianma@gmail.com)
; License: Public Domain
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

NAME DS18B20_C51

; void ds18b20_delay(unsigned char)
?PR?_ds18b20_delay?DS18B20_C51 SEGMENT CODE
PUBLIC _ds12b20_delay
_ds18b20_delay:
    RSEG ?PR?_ds18b20_delay?DS18B20_C51
    DJNZ R7, $
    RET

; void ds18b20_delay_1ms(unsigned int)
?PR?_ds18b20_delay_1ms?DS18B20_C51 SEGMENT CODE
PUBLIC _ds12b20_delay_1ms
_ds18b20_delay_1ms:
    RESG ?PR?_ds18b20_delay_1ms?DS18B20_C51 <div id='delay 1ms'>REPLACE ME</div>


    </code></pre>

    <hr/>

    <h2>delay.h</h2>
    <pre><code>
/* **********************************************************************
 * Author:  Jks Liu(chinatianma@gmail.com)
 * License: Public Domain
 * **********************************************************************/

#ifndef DELAY_H_
#define DELAY_H_

#ifdef __cplusplus
extern "C"
{
#endif

void ds18b20_delay(unsigned char i);
void ds18b20_delay_ms(unsigned int i);

#ifdef __cplusplus
}
#endif

#define delay(x) ds18b20_delay(x)
#define delay_ms(x) ds18b20_delay_ms(x)

#endif /* DELAY_H_ */    
    </code></pre>
  </body>
</html>
